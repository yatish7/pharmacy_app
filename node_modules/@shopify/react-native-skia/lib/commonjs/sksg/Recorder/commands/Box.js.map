{"version":3,"names":["_nodes","require","_types","_Core","isBoxCommand","command","type","CommandType","DrawBox","exports","drawBox","ctx","shadows","forEach","shadow","materializeProps","map","props","paint","Skia","canvas","box","defaultBox","opacity","getAlphaf","isRRect","RRectXY","filter","inner","color","blur","spread","dx","dy","lPaint","Paint","setColor","processColor","setAlphaf","setMaskFilter","MaskFilter","MakeBlur","BlurStyle","Normal","drawRRect","inflate","delta","Point","Math","abs","save","clipRRect","ClipOp","Intersect","Color","deflate","outer","x","y","drawDRRect","restore"],"sources":["Box.ts"],"sourcesContent":["import { deflate, inflate, processColor } from \"../../../dom/nodes\";\nimport type { BoxProps, BoxShadowProps } from \"../../../dom/types\";\nimport { BlurStyle, ClipOp, isRRect } from \"../../../skia/types\";\nimport type { Command } from \"../Core\";\nimport { CommandType, materializeProps } from \"../Core\";\nimport type { DrawingContext } from \"../DrawingContext\";\n\ninterface BoxCommand extends Command<CommandType.DrawBox> {\n  props: BoxProps;\n  shadows: { props: BoxShadowProps }[];\n}\n\nexport const isBoxCommand = (command: Command): command is BoxCommand => {\n  \"worklet\";\n  return command.type === CommandType.DrawBox;\n};\n\nexport const drawBox = (ctx: DrawingContext, command: BoxCommand) => {\n  \"worklet\";\n  command.shadows.forEach((shadow) => {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    materializeProps(shadow as any);\n  });\n  const shadows = command.shadows.map((shadow) => shadow.props);\n  const { paint, Skia, canvas } = ctx;\n  const { box: defaultBox } = command.props;\n  const opacity = paint.getAlphaf();\n  const box = isRRect(defaultBox) ? defaultBox : Skia.RRectXY(defaultBox, 0, 0);\n  shadows\n    .filter((shadow) => !shadow.inner)\n    .map((shadow) => {\n      const { color = \"black\", blur, spread = 0, dx = 0, dy = 0 } = shadow;\n      const lPaint = Skia.Paint();\n      lPaint.setColor(processColor(Skia, color));\n      lPaint.setAlphaf(paint.getAlphaf() * opacity);\n      lPaint.setMaskFilter(\n        Skia.MaskFilter.MakeBlur(BlurStyle.Normal, blur, true)\n      );\n      canvas.drawRRect(inflate(Skia, box, spread, spread, dx, dy), lPaint);\n    });\n\n  canvas.drawRRect(box, paint);\n\n  shadows\n    .filter((shadow) => shadow.inner)\n    .map((shadow) => {\n      const { color = \"black\", blur, spread = 0, dx = 0, dy = 0 } = shadow;\n      const delta = Skia.Point(10 + Math.abs(dx), 10 + Math.abs(dy));\n      canvas.save();\n      canvas.clipRRect(box, ClipOp.Intersect, false);\n      const lPaint = Skia.Paint();\n      lPaint.setColor(Skia.Color(color));\n      lPaint.setAlphaf(paint.getAlphaf() * opacity);\n\n      lPaint.setMaskFilter(\n        Skia.MaskFilter.MakeBlur(BlurStyle.Normal, blur, true)\n      );\n      const inner = deflate(Skia, box, spread, spread, dx, dy);\n      const outer = inflate(Skia, box, delta.x, delta.y);\n      canvas.drawDRRect(outer, inner, lPaint);\n      canvas.restore();\n    });\n};\n"],"mappings":"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","ignoreList":[]}